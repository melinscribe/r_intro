<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Conflict and Event Data - Merging Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Conflict and Event Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session01.html" rel="" target="">
 <span class="menu-text">1: Getting Started with R</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session02.html" rel="" target="">
 <span class="menu-text">2: Exploring Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session03.html" rel="" target="">
 <span class="menu-text">3: Data Wrangling</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./session04.html" rel="" target="" aria-current="page">
 <span class="menu-text">Merging Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session05.html" rel="" target="">
 <span class="menu-text">5: Descriptive Statistics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session06.html" rel="" target="">
 <span class="menu-text">Regressions</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./session07.html" rel="" target="">
 <span class="menu-text">Visualizations</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">üéØ Learning Goals</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">üìñ Introduction</a>
  <ul class="collapse">
  <li><a href="#what-does-merging-mean" id="toc-what-does-merging-mean" class="nav-link" data-scroll-target="#what-does-merging-mean">üóÇ What Does Merging Mean?</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a>
  <ul class="collapse">
  <li><a href="#built-in-functions" id="toc-built-in-functions" class="nav-link" data-scroll-target="#built-in-functions">‚ÄúBuilt-in‚Äù functions</a></li>
  <li><a href="#world-bank" id="toc-world-bank" class="nav-link" data-scroll-target="#world-bank">World Bank</a></li>
  </ul></li>
  <li><a href="#recode-categories" id="toc-recode-categories" class="nav-link" data-scroll-target="#recode-categories">Recode categories</a></li>
  </ul></li>
  <li><a href="#merging" id="toc-merging" class="nav-link" data-scroll-target="#merging">Merging</a>
  <ul class="collapse">
  <li><a href="#crosstabs" id="toc-crosstabs" class="nav-link" data-scroll-target="#crosstabs">Crosstabs</a></li>
  </ul></li>
  <li><a href="#save-new-dataframe" id="toc-save-new-dataframe" class="nav-link" data-scroll-target="#save-new-dataframe">Save new dataframe</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Merging Data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"dplyr"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"WDI"</span>, </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">"countrycode"</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Install uninstalled packages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(packages[<span class="sc">!</span>(packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>())], install.packages)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all packages to library</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>)            </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="learning-goals" class="level1">
<h1>üéØ Learning Goals</h1>
<p>By the end of this session, you will be able to:</p>
<ul>
<li>Understand <strong>why</strong> we merge datasets in conflict research</li>
<li>Learn the difference between <strong>left join</strong>, <strong>right join</strong>, <strong>inner join</strong>, and <strong>full join</strong></li>
<li>Merge UCDP and ACLED data by <strong>country-year</strong></li>
<li>Practice combining datasets with dplyr</li>
</ul>
<hr>
</section>
<section id="introduction" class="level1">
<h1>üìñ Introduction</h1>
<p>In conflict research, <strong>no single dataset</strong> has all the answers.</p>
<ul>
<li><strong>UCDP</strong> ‚Üí information on <strong>conflict dyads</strong>, battle-related deaths<br>
</li>
<li><strong>ACLED</strong> ‚Üí detailed <strong>event data</strong> with dates &amp; locations</li>
</ul>
<p>üëâ To do better analysis, we often <strong>merge</strong> these datasets.</p>
<hr>
<section id="what-does-merging-mean" class="level2">
<h2 class="anchored" data-anchor-id="what-does-merging-mean">üóÇ What Does Merging Mean?</h2>
<ul>
<li><strong>Merging</strong> = bringing two datasets together based on <strong>shared keys</strong>.</li>
</ul>
<p>Example:</p>
<table class="table">
<thead>
<tr class="header">
<th>country</th>
<th>year</th>
<th>fatalities_ucdp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Kenya</td>
<td>2020</td>
<td>42</td>
</tr>
<tr class="even">
<td>Sudan</td>
<td>2020</td>
<td>30</td>
</tr>
</tbody>
</table>
<ul>
<li></li>
</ul>
<table class="table">
<thead>
<tr class="header">
<th>country</th>
<th>year</th>
<th>fatalities_acled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Kenya</td>
<td>2020</td>
<td>20</td>
</tr>
<tr class="even">
<td>Somalia</td>
<td>2020</td>
<td>15</td>
</tr>
</tbody>
</table>
<p><strong>Merged by country-year ‚Üí</strong></p>
<table class="table">
<thead>
<tr class="header">
<th>country</th>
<th>year</th>
<th>fatalities_ucdp</th>
<th>fatalities_acled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Kenya</td>
<td>2020</td>
<td>42</td>
<td>20</td>
</tr>
<tr class="even">
<td>Sudan</td>
<td>2020</td>
<td>30</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>Somalia</td>
<td>2020</td>
<td>NA</td>
<td>15</td>
</tr>
</tbody>
</table>
<p>The general merging procedure follows these steps:</p>
<ol type="1">
<li>Read in data</li>
<li>(Look at data)</li>
<li>Identify unique identifier (usually country and year)</li>
<li>Merge</li>
<li>Check if everything went well</li>
</ol>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Data/GEDEvent_v25_1.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have so many information in this dataset but we do not need all of them. We just keep the variables that we really need using the select command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="ot">&lt;-</span> ucdp <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(conflict_new_id, country, year, date_start, date_end, deaths_a, deaths_b,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>   deaths_civilians, deaths_unknown, low, best, high)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The variable ‚Äúcountry‚Äù gives us information on the country We apply the countrycode() function to generate our new variable called ‚Äúregion‚Äù.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ucdp <span class="ot">&lt;-</span> ucdp <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">countrycode</span>(country, <span class="st">"country.name"</span>, <span class="st">"continent"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We get the following message: Some values were not matched unambiguously: Yemen (North Yemen)</p>
<p>Since this country is not part of the African continent, we can ignore it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Restrict to the African continent</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ucdp_africa <span class="ot">&lt;-</span> ucdp <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Africa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ucdp_africa <span class="sc">%&gt;%</span> <span class="co"># address dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>() <span class="co"># get a glimpse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 69,511
Columns: 13
$ conflict_new_id  &lt;dbl&gt; 386, 386, 386, 386, 386, 386, 386, 386, 386, 386, 386‚Ä¶
$ country          &lt;chr&gt; "Algeria", "Algeria", "Algeria", "Algeria", "Algeria"‚Ä¶
$ year             &lt;dbl&gt; 1990, 1991, 1991, 1991, 1991, 1992, 1992, 1992, 1992,‚Ä¶
$ date_start       &lt;dttm&gt; 1990-12-20, 1991-11-29, 1991-12-04, 1991-12-07, 1991‚Ä¶
$ date_end         &lt;dttm&gt; 1990-12-20, 1991-11-29, 1991-12-05, 1991-12-07, 1991‚Ä¶
$ deaths_a         &lt;dbl&gt; 1, 3, 0, 1, 4, 1, 0, 0, 0, 0, 31, 1, 2, 6, 1, 2, 2, 2‚Ä¶
$ deaths_b         &lt;dbl&gt; 0, 0, 2, 9, 13, 1, 1, 2, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0‚Ä¶
$ deaths_civilians &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,‚Ä¶
$ deaths_unknown   &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
$ low              &lt;dbl&gt; 1, 3, 4, 10, 17, 2, 1, 2, 2, 1, 31, 1, 2, 6, 2, 2, 2,‚Ä¶
$ best             &lt;dbl&gt; 1, 3, 4, 10, 17, 2, 1, 2, 2, 1, 31, 1, 2, 6, 2, 2, 2,‚Ä¶
$ high             &lt;dbl&gt; 1, 3, 4, 10, 17, 2, 1, 2, 2, 1, 103, 1, 2, 6, 2, 2, 3‚Ä¶
$ region           &lt;chr&gt; "Africa", "Africa", "Africa", "Africa", "Africa", "Af‚Ä¶</code></pre>
</div>
</div>
<p>We will merge this data with World Bank Data that comes in yearly measures. We need to aggregate the UCDP Data to yearly units by summarizing the indicators we‚Äôre interested in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ucdp_africa <span class="ot">&lt;-</span> ucdp_africa <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths_a =</span> <span class="fu">sum</span>(deaths_a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths_b =</span> <span class="fu">sum</span>(deaths_b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths_civilians =</span> <span class="fu">sum</span>(deaths_civilians, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths_unknown =</span> <span class="fu">sum</span>(deaths_unknown, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="fu">sum</span>(low, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">best =</span> <span class="fu">sum</span>(best, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="fu">sum</span>(high, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ucdp_africa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   country               year         deaths_a           deaths_b      
 Length:904         Min.   :1989   Min.   :     0.0   Min.   :    0.0  
 Class :character   1st Qu.:1997   1st Qu.:     0.0   1st Qu.:    0.0  
 Mode  :character   Median :2007   Median :    13.0   Median :   17.0  
                    Mean   :2007   Mean   :   485.3   Mean   :  262.2  
                    3rd Qu.:2017   3rd Qu.:    92.0   3rd Qu.:  157.2  
                    Max.   :2024   Max.   :132995.0   Max.   :25773.0  
 deaths_civilians   deaths_unknown         low                best       
 Min.   :     0.0   Min.   :    0.0   Min.   :     0.0   Min.   :     0  
 1st Qu.:     1.0   1st Qu.:    0.0   1st Qu.:    12.0   1st Qu.:    14  
 Median :    23.0   Median :   10.0   Median :   135.0   Median :   141  
 Mean   :  1197.2   Mean   :  314.8   Mean   :  1717.8   Mean   :  2260  
 3rd Qu.:   225.2   3rd Qu.:  152.2   3rd Qu.:   838.5   3rd Qu.:   943  
 Max.   :771118.0   Max.   :48355.0   Max.   :347614.0   Max.   :772463  
      high        
 Min.   :      1  
 1st Qu.:     19  
 Median :    212  
 Mean   :   3746  
 3rd Qu.:   1279  
 Max.   :1612663  </code></pre>
</div>
</div>
<section id="built-in-functions" class="level3">
<h3 class="anchored" data-anchor-id="built-in-functions">‚ÄúBuilt-in‚Äù functions</h3>
<p>Some data resources like the <a href="https://cran.r-project.org/web/packages/WDI/WDI.pdf">World Bank</a> or Quality of Government, provide R packages that allow us to read in data automatically.</p>
</section>
<section id="world-bank" class="level3">
<h3 class="anchored" data-anchor-id="world-bank">World Bank</h3>
<p>We will use the World Bank dataset to retrieve information on <strong>population size</strong> and <strong>GDP per capita</strong>.</p>
<p>You can search for data by using keywords in WDIsearch. For instance, if you are looking for data on Gross Domestic Product:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("WDI")</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WDI)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">WDIsearch</span>(<span class="st">'gdp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>WDIsearch</code> uses grep and ignores cases, so you can also use regular expressions. For instance, if you are looking for GDP per capita in constant dollars:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WDIsearch</span>(<span class="st">'gdp.*capita.*constant'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 indicator                                                 name
692     6.0.GDPpc_constant GDP per capita, PPP (constant 2011 international $) 
13789       NY.GDP.PCAP.KD                   GDP per capita (constant 2015 US$)
13791       NY.GDP.PCAP.KN                        GDP per capita (constant LCU)
13793    NY.GDP.PCAP.PP.KD  GDP per capita, PPP (constant 2021 international $)
13794 NY.GDP.PCAP.PP.KD.87  GDP per capita, PPP (constant 1987 international $)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>wb_data<span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">"all"</span>, <span class="at">indicator =</span> <span class="fu">c</span>(<span class="st">"population"</span> <span class="ot">=</span><span class="st">"SP.POP.TOTL"</span>,<span class="st">"gdp_pc"</span> <span class="ot">=</span> <span class="st">"NY.GDP.PCAP.KD"</span>), <span class="co"># select the indicator</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">start =</span> <span class="dv">1990</span>, <span class="co"># define the start date</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">end =</span> <span class="dv">2024</span>) <span class="co"># define the end date</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also further define which countries you want to include and add more indicators.</p>
<p>Subset to Africa</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>wb_data <span class="ot">&lt;-</span> wb_data <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">countrycode</span>(iso3c, <span class="st">"iso3c"</span>, <span class="st">"continent"</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>wb_africa <span class="ot">&lt;-</span> wb_data <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Africa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The warnings you get are from regional iso codes in the World Bank Data, nothing to worry about.</p>
</section>
</section>
<section id="recode-categories" class="level2">
<h2 class="anchored" data-anchor-id="recode-categories">Recode categories</h2>
<p>Sometimes, we‚Äôre more interested in broad categories than exact values, e.g.&nbsp;I want to know whether a country has a low GDP per capita.</p>
<p>First, check the distribution of the variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(wb_africa<span class="sc">$</span>gdp_pc, <span class="at">na.rm=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   188.6583 19481.6461</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wb_africa<span class="sc">$</span>gdp_pc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
  188.7   615.2  1067.4  2182.5  2431.8 19481.6      65 </code></pre>
</div>
</div>
<p>Based on these numbers, decide on your own cut-off points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>wb_africa<span class="sc">$</span>gdp <span class="ot">&lt;-</span> <span class="fu">cut</span>(wb_africa<span class="sc">$</span>gdp_pc, <span class="co">#define new variable name with 'edu', define variable of origin 'edulvlb'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">3000</span>, <span class="cn">Inf</span>), <span class="co">#define breaks for new categories</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"low"</span>,<span class="st">"middle"</span>,<span class="st">"high"</span>)) <span class="co">#define names for new categories</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wb_africa<span class="sc">$</span>gdp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   low middle   high 
   857    573    395 </code></pre>
</div>
</div>
</section>
</section>
<section id="merging" class="level1">
<h1>Merging</h1>
<p>After having a quick look at the data, we now need to identify a unique identifier. Typical identifiers are usually a <em>geograpical location</em> and a <em>time variable</em>. For today‚Äôs session we will use the information on the <em>country</em> and on the <em>year</em>. Both datasets have a country variable. Both variables contain full country names. Because spelling inconsistencies would lead to non-matching in the merging procedure, it is always advised to choose <strong>unique</strong> identifiers. We will create an identifier with the function <code>countrycode()</code>. We will now generate <a href="https://www.iso.org/obp/ui/#search">ISO3 country codes</a>. We simply replace <code>"country"</code> with <code>"iso3c"</code>. The World Bank Data already entails the iso3c code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the UCDP dataset</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ucdp_africa <span class="ot">&lt;-</span> ucdp_africa <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">iso3c =</span> <span class="fu">countrycode</span>(country, <span class="st">"country.name"</span>, <span class="st">"iso3c"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we receive no error/warning messages, everything seemed to have worked perfectly.</p>
<p>Both datasets have a variable called <code>year</code> that gives us information on the year.</p>
<p><strong>Now we are all set for the merging.</strong></p>
<p>We will use again the <code>tidyverse</code> and more specifically the package <code>dplyr</code> (see code on your cheat sheet for combining datasets). It offers various operators for merging datasets. The most frequently used are <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, and <code>full_join()</code>. It always takes the arguments in the following order: <code>left_join(dataset1, dataset2, by="common_identifier")</code>. If we execute a <code>left_join()</code> we would then logically only keep matching rows from dataset1 (which is left). An <code>inner_join()</code> command keeps only rows that match both datasets whereas a <code>full_join()</code> keeps all observations.</p>
<p>Let‚Äôs think logically what we get and what we need. If we use the command <code>left_join()</code>, which data do we keep?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> ucdp_africa <span class="sc">%&gt;%</span> <span class="co"># generate new dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wb_africa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"iso3c"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case we only keep the countries that experienced conflict (and are present in the <code>ucdp</code> dataset). If your research question requires a different data basis, you need to use a different merging command.</p>
<p>If you inspect the new dataframe, you see that variables that appeared in both dataframes but were not used as identifiers have now an .x or .y at the end of their name. This identifies from which dataset they come. To avoid this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>combined <span class="ot">&lt;-</span> ucdp_africa <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wb_africa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"iso3c"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".x"</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="crosstabs" class="level2">
<h2 class="anchored" data-anchor-id="crosstabs">Crosstabs</h2>
<p>Let‚Äôs see how conflict affected countries fare with their GDP. First, we create the conflict categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>combined<span class="sc">$</span>conflict <span class="ot">&lt;-</span> <span class="fu">cut</span>(combined<span class="sc">$</span>best, <span class="co">#define new variable name with 'edu', define variable of origin 'edulvlb'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">999</span>, <span class="cn">Inf</span>), <span class="co">#define breaks for new categories</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"Minor Conflict"</span>,<span class="st">"Major Conflict"</span>)) <span class="co">#define names for new categories</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined<span class="sc">$</span>conflict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Minor Conflict Major Conflict 
           417            218 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined<span class="sc">$</span>gdp, combined<span class="sc">$</span>conflict) <span class="co"># Check cross table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
         Minor Conflict Major Conflict
  low               217            135
  middle            118             59
  high               56             15</code></pre>
</div>
</div>
<p>For percentage-wise crosstabs, use <code>prop.table()</code></p>
<ul>
<li>margin = 1 ‚Üí row percentages</li>
<li>margin = 2 ‚Üí column percentages</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(combined<span class="sc">$</span>gdp, combined<span class="sc">$</span>conflict), <span class="at">margin =</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        
         Minor Conflict Major Conflict
  low         55.498721      64.593301
  middle      30.179028      28.229665
  high        14.322251       7.177033</code></pre>
</div>
</div>
</section>
</section>
<section id="save-new-dataframe" class="level1">
<h1>Save new dataframe</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save a dataset as CSV</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(combined, <span class="st">"Data/combined.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Save dataset as RDS</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(combined, <span class="st">"Data/combined.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>CSV‚Äù</strong></p>
<ul>
<li>row.names = FALSE prevents R from saving extra row numbers as a column</li>
<li>Always include .csv in the file name</li>
<li>Plain text (human-readable)</li>
<li>Universal (opens in R, Excel, Python, etc.)</li>
<li>Great for sharing</li>
</ul>
<p><strong>RDS</strong></p>
<ul>
<li>A native R format (binary)</li>
<li>Saves R objects exactly as they are (including classes, factors, attributes)</li>
<li>Can only be opened in R</li>
<li>Keeps everything (data types, factors, labels) intact.</li>
<li>Faster to load than CSV.</li>
<li>Great for long-term storage of cleaned datasets.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>